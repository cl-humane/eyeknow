<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Page</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>


<!-- Action Buttons -->
<div class="header">
  <div class="toolbar">
    <div class="left-buttons">
      <div class="btn add-btn" id="addObjectBtn">
        <i class="fa-solid fa-plus white-icon"></i> 
        Add Object
      </div>
    </div>
    
    <div class="right-buttons">
      <p>Search:</p>
      <div class="search-container">
        <input type="text" placeholder="Search..." />
      </div>
      <div class="sort-container">
        <div class="btn sort-btn" id="sortBtn">
          <i class="fa-solid fa-sort"></i>
          Sort
        </div>
        <div class="sort-dropdown" id="sortDropdown">
          <div class="sort-option" data-sort="updated">Date Updated</div>
          <div class="sort-option" data-sort="name-asc">Name (A-Z)</div>
          <div class="sort-option" data-sort="name-desc">Name (Z-A)</div>
        </div>
      </div>
      <div class="btn download-btn">
        <i class="fa-solid fa-download"></i>
        Download
      </div>
      <div class="btn logout-btn" id="logoutTrigger">
        <i class="fa-solid fa-right-from-bracket"></i>
        Logout
      </div>
    </div>
  </div>
</div>


<!-- Folder Info -->
<div class="folder-info">
  <div class="info-block-left">Project Name: <strong id="folderName">{{ folder_name }}</strong></div>
  <div class="info-block-center">Last Updated: <strong id="lastUpdated">{{ last_updated }}</strong></div>
  <div class="info-block-right"><em>Created: <strong id="dateCreated">{{ date_created }}</strong></em></div>
</div>


<!-- Add Object Form -->
<div class="bgPop" id="add">
  <div class="add-box">
    <h1><span class="add">Add</span> <span class="object">Object</span></h1>
    <form id="uploadForm" class="add-form">
      <label for="batchName">Object Name:</label>
      <input type="text" id="batchName" name="batchName" placeholder="Enter object name" required autocomplete="off">

      <!-- Drop Area -->
      <div id="dropArea">
        <div class="drop-header">
          <span class="browse-btn">Browse...</span>
          <span class="or-text">Or drop files/folder here</span>
        </div>
        <ul id="fileList"></ul>
        <div class="drop-error-message" id="dropErrorMessage">Please select at least one file to upload.</div>
        <input type="file" id="fileInput" name="files" multiple accept="image/*"/>
      </div>

      <div class="error-message" id="errorMessage"></div>

      <!-- Buttons -->
      <div class="button-spacing">
        <button type="button" id="cancelBtn" class="cancel-btn">Cancel</button>
        <button type="submit" class="upload-btn">Upload</button>
      </div>
    </form>
  </div>
</div>

<!-- Success Add Pop Up -->
<div class="overlay" id="successAdd" onclick="closeSuccessPopup(event)">
  <div class="success-content">
    <button class="close-btn" onclick="closeSuccessPopup()">&times;</button>
    <i class="fa-solid fa-check"></i>
    <h3 class="success-title">Upload Successful!</h3>
    <p id="successPopupMessage" class="success-message"></p>
    <button class="ok-btn" onclick="closeSuccessPopup()">OK</button>
  </div>
</div>

<!-- Error Pop Up -->
<div class="overlay" id="generalError" onclick="closeGeneralErrorPopup(event)">
  <div class="error-content">
    <button class="close-btn" onclick="closeGeneralErrorPopup()">&times;</button>
    <i class="fa-solid fa-exclamation-triangle"></i>
    <h3 class="error-title">Upload Error</h3>
    <p id="generalErrorMessage" class="error-message">
      An unexpected error occurred.<br>
      Please try again.
    </p>
    <div class="button-spacing">
      <button class="retry-btn" onclick="retryUpload()">Retry</button>
      <button class="cancel-btn" onclick="closeGeneralErrorPopup()">Cancel</button>
    </div>
  </div>
</div>

<!-- Conflict/Merge Pop Up -->
<div class="overlay" id="conflictPopup" onclick="closeConflictPopup(event)">
  <div class="conflict-content">
    <button class="close-btn" onclick="closeConflictPopup()">&times;</button>
    <i class="fa-solid fa-triangle-exclamation"></i>
    <h3 class="conflict-title">Object Already Exists</h3>
    <p id="conflictMessage" class="conflict-message">
      An object with the name 
      "<span class="object-name" id="conflictObjectName"></span>" 
      already exists. Would you like to merge the files or cancel the upload?
    </p>
    <div class="button-spacing">
      <button class="merge-btn" onclick="handleMerge()">Merge</button>
      <button class="cancel-btn" onclick="closeConflictAndForm()">Cancel</button>
    </div>
  </div>
</div>


<!-- Dashboard Object Lists -->
<div class="data-table">
  <table>
    <thead>
      <tr>
        <th>No.</th>
        <th>Object Name</th>
        <th>Date Uploaded</th>
        <th>Date Updated</th>
        <th>Created By</th>
        <th>Size</th>
      </tr>
    </thead>
    <tbody>
      {% for object in objects %}
      <tr data-object-id="{{ object.object_id }}">
        <td>{{ loop.index }}</td>
        <td>{{ object.object_name }}</td>
        <td>{{ object.date_created_formatted }}</td>
        <td>{{ object.date_updated_formatted }}</td>
        <td>{{ object.created_by_name }}</td>
        <td>{{ object.size_formatted }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Object Details -->
<div class="bgPop" id="filesPop">
  <div class="file-container">
    <div class="file-container-header">
      <button class="file-close-btn" id="closeaddBtn">&times;</button>
    </div>
    <h2><span class="object">Object</span> <span class="details">Details</span></h2>
    <div class="object-header">
  <div class="object-name">
    <strong>Object Name:</strong> <span id="addObjectName"></span>
  </div>
  <button class="edit-btn">
    <i class="fa-solid fa-pen-to-square"></i> Edit Object
  </button>
</div>
    <div class="file-table">
      <table class="file-list">
        <thead>
          <tr>
            <th>No.</th>
            <th>File Name</th>
            <th>Date Created</th>
            <th>Created By</th>
            <th>Size</th>
          </tr>
        </thead>
        <tbody>

        </tbody>
      </table>
    </div>
  </div>
</div>


<!-- REPLACE your Edit Object Form section with this: -->

<!-- Edit Object Form -->
<div class="bgPop" id="editObjectPop">
  <div class="edit-box">
    <h1><span class="edit">Edit</span> <span class="object">Object</span></h1>
    <form id="editObjectForm" class="edit-form">
      <label for="editObjectName">Object Name:</label>
      <input type="text" id="editObjectName" name="editObjectName" placeholder="Enter object name" required autocomplete="off">

      <!-- Drop Area for adding more files - CHANGED ID -->
      <div id="editDropArea">
        <div class="drop-header">
          <span class="browse-btn">Browse...</span>
          <span class="or-text">Or drop files/folder here</span>
        </div>
        <ul id="editFileList"></ul>
        <div class="drop-error-message" id="editDropErrorMessage">Please select at least one file to upload.</div>
        <input type="file" id="editFileInput" name="files" multiple accept="image/*"/>
      </div>

      <!-- Add these missing message elements -->
      <div class="error-message" id="editErrorMessage" style="display: none;"></div>
      <div class="success-message" id="editSuccessMessage" style="display: none;"></div>

      <div class="button-spacing">
        <button type="button" class="cancel-btn" id="editCancelBtn">Cancel</button>
        <button type="submit" class="upload-btn">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Success Popup -->
<div class="overlay" id="editSuccessAdd" onclick="closeEditSuccessPopup(event)">
  <div class="success-content">
    <button class="close-btn" onclick="closeEditSuccessPopup()">&times;</button>
    <i class="fa-solid fa-check"></i>
    <h3 class="success-title">Update Successful!</h3>
    <p id="editSuccessPopupMessage" class="success-message"></p>
    <button class="ok-btn" onclick="closeEditSuccessPopup()">OK</button>
  </div>
</div>

<!-- Edit Error Popup -->
<div class="overlay" id="editGeneralError" onclick="closeEditGeneralErrorPopup(event)">
  <div class="error-content">
    <button class="close-btn" onclick="closeEditGeneralErrorPopup()">&times;</button>
    <i class="fa-solid fa-exclamation-triangle"></i>
    <h3 class="error-title">Update Error</h3>
    <p id="editGeneralErrorMessage" class="error-message">
      An unexpected error occurred.<br>
      Please try again.
    </p>
    <div class="button-spacing">
      <button class="retry-btn" onclick="retryEditUpload()">Retry</button>
      <button class="cancel-btn" onclick="closeEditGeneralErrorPopup()">Cancel</button>
    </div>
  </div>
</div>

<!-- Edit Conflict/Merge Popup -->
<div class="overlay" id="editConflictPopup" onclick="closeEditConflictPopup(event)">
  <div class="conflict-content">
    <button class="close-btn" onclick="closeEditConflictPopup()">&times;</button>
    <i class="fa-solid fa-triangle-exclamation"></i>
    <h3 class="conflict-title">Object Already Exists</h3>
    <p id="editConflictMessage" class="conflict-message">
      An object with the name 
      "<span class="object-name" id="editConflictObjectName"></span>" 
      already exists. Would you like to merge the files or cancel the update?
    </p>
    <div class="button-spacing">
      <button class="merge-btn" onclick="handleEditMerge()">Merge</button>
      <button class="cancel-btn" onclick="closeEditConflictAndForm()">Cancel</button>
    </div>
  </div>
</div>


<!-- Logout Confirmation -->
<div class="bgPop" id="logoutadd">
  <div class="logout-box">
    <h3 class="logout-title">Confirm Logout</h3>
    <p class="logout-message">
      Are you sure you want to log out?
    </p>
    <div class="logout-action">
      <button class="cancel-btn" id="cancelLogout">Cancel</button>
      <form method="GET" action="{{ url_for('logout') }}">
        <button type="submit" class="upload-btn">Confirm</button>
      </form>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>